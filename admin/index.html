<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÙˆÙ‚ Ø¹ÙƒØ§Ø² | Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø°ÙƒÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800;900&family=Reem+Kufi:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #e67e22; --dark: #0a0a0a; --sidebar: #121212; --card: #1a1a1a; --text: #f1f2f6; --text-muted: #a4b0be; --danger: #ff4757; --success: #2ed573; --info: #3742fa; --warning: #ffa502; }
        body { font-family: 'Cairo', sans-serif; background: var(--dark); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        .sidebar { width: 260px; background: var(--sidebar); border-left: 1px solid #222; display: flex; flex-direction: column; padding: 20px 0; box-shadow: -5px 0 15px rgba(0,0,0,0.5); z-index: 1000; overflow-y:auto; transition: right 0.3s ease; }
        .logo-area { text-align: center; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #222; }
        .logo-area h2 { color: var(--primary); margin: 0; font-family: 'Reem Kufi', sans-serif; font-size: 1.8em;}
        .nav-btn { display: flex; align-items: center; gap: 15px; padding: 15px 25px; color: var(--text-muted); cursor: pointer; transition: 0.3s; border-right: 4px solid transparent; font-size: 1.1em; font-weight: 600; background: none; border: none; width: 100%; text-align: right; }
        .nav-btn:hover, .nav-btn.active { background: #1f1f1f; color: var(--primary); border-right-color: var(--primary); }
        .nav-btn i { font-size: 1.2em; width: 25px; text-align: center; }

        .main-content { flex: 1; padding: 30px; overflow-y: auto; background: var(--dark); position: relative; }
        .section { display: none; animation: fadeIn 0.4s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .mobile-header { display: none; background: #111; padding: 15px 20px; border-bottom: 2px solid var(--primary); align-items: center; justify-content: space-between; margin: -30px -30px 20px -30px; position: sticky; top: 0; z-index: 99; }
        .mobile-menu-btn { background: none; border: none; color: var(--primary); font-size: 1.6em; cursor: pointer; }
        .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 999; display: none; backdrop-filter: blur(3px); }
        .sidebar-overlay.active { display: block; }

        @media (max-width: 900px) { .sidebar { position: fixed; right: -260px; height: 100vh; } .sidebar.active { right: 0; } .mobile-header { display: flex; } .main-content { padding: 15px; padding-top: 30px; } .flex-row > div { min-width: 100%; } .stats-grid { grid-template-columns: 1fr; } }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { padding: 25px; border-radius: 15px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 4px 15px rgba(0,0,0,0.3); transition: 0.3s; cursor: pointer; }
        .stat-card:hover { transform: translateY(-5px); border-width: 2px; }
        .stat-card.success { background: linear-gradient(135deg, rgba(46, 213, 115, 0.15), rgba(0,0,0,0.8)); border: 1px solid var(--success); }
        .stat-card.info { background: linear-gradient(135deg, rgba(55, 66, 250, 0.15), rgba(0,0,0,0.8)); border: 1px solid var(--info); }
        .stat-card.warning { background: linear-gradient(135deg, rgba(255, 165, 2, 0.15), rgba(0,0,0,0.8)); border: 1px solid var(--warning); }
        .stat-card.danger { background: linear-gradient(135deg, rgba(255, 71, 87, 0.15), rgba(0,0,0,0.8)); border: 1px solid var(--danger); }
        .stat-info h3 { margin: 0; font-size: 1em; color: #ccc; pointer-events: none; } .stat-info p { margin: 5px 0 0; font-size: 1.8em; font-weight: 900; color: #fff; pointer-events: none; } .stat-icon { font-size: 3.5em; opacity: 0.8; pointer-events: none; }
        .stat-card.success .stat-icon { color: var(--success); } .stat-card.info .stat-icon { color: var(--info); } .stat-card.warning .stat-icon { color: var(--warning); } .stat-card.danger .stat-icon { color: var(--danger); }

        .panel { background: var(--card); padding: 25px; border-radius: 15px; border: 1px solid #222; margin-bottom: 20px; }
        .panel-title { color: var(--primary); margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 20px; font-size: 1.2em; display: flex; align-items:center; gap:10px; }
        
        table { width: 100%; border-collapse: collapse; font-size: 0.9em; } th { background: #111; color: var(--text-muted); padding: 15px; text-align: right; border-bottom: 2px solid #222; font-weight: bold;} td { padding: 15px; border-bottom: 1px solid #222; color: #eee; } tr:hover td { background: #1a1a1a; }
        
        .input-group { margin-bottom: 15px; } .input-group label { display: block; margin-bottom: 6px; color: var(--text-muted); font-size: 0.85em; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid #333; background: #111; color: #fff; font-family: 'Cairo'; outline: none; box-sizing: border-box;}
        input[type="file"] { padding: 6px; background: #222; cursor: pointer; } input:focus, select:focus, textarea:focus { border-color: var(--primary); }
        .checkbox-label { display: flex; align-items: center; gap: 10px; cursor: pointer; color: #fff; font-size: 0.9em; margin-bottom: 10px; } .checkbox-label input { width: auto; transform: scale(1.2); cursor: pointer;}
        
        .btn-main { background: var(--primary); color: #000; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: 800; font-family: 'Cairo'; width: 100%; transition: 0.3s; }
        .btn-main:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(230,126,34,0.3); }
        .btn-sm { padding: 5px 10px; border-radius: 5px; cursor: pointer; border: none; font-family: 'Cairo'; font-weight: bold; font-size:0.8em; } .btn-edit { background: var(--info); color: #fff; } .btn-delete { background: var(--danger); color: #fff; }
        .flex-row { display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 15px;} .flex-row > div { flex: 1; min-width: 200px; }
        
        #loader { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 9999; display: none; justify-content: center; align-items: center; flex-direction: column; color: var(--primary); }
        .spinner { border: 5px solid #222; border-top: 5px solid var(--primary); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin-bottom: 15px; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .status-select { background: #333; border: 1px solid #555; color: #fff; padding: 5px; border-radius: 5px; font-family: 'Cairo'; width: auto; font-weight:bold; cursor:pointer;}
        .size-checkbox-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; margin-top: 10px; } .size-box { background: #222; border: 1px solid #444; border-radius: 8px; padding: 10px; text-align: center; cursor: pointer; transition: 0.3s; color: #fff; font-weight: bold; user-select: none; } .size-box.selected { background: var(--primary); color: #000; border-color: var(--primary); } .size-box input { display: none; }

        .switch-container { display: flex; justify-content: space-between; align-items: center; background: #111; padding: 15px; border-radius: 8px; border: 1px solid #333; margin-bottom: 15px; }
        .switch-container span { font-weight: bold; color: #fff; font-size: 0.9em;}
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; } .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background-color: #444; transition: .4s; border-radius: 34px; } .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; } input:checked + .slider { background-color: var(--success); } input:checked + .slider:before { transform: translateX(24px); }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: none; overflow-y: auto; backdrop-filter: blur(5px); }
        .modal-content { background: #111; width: 95%; max-width: 900px; border-radius: 20px; padding: 25px; border: 1px solid var(--primary); margin: 30px auto; position: relative; }
        .close-btn { position: absolute; top: 15px; left: 15px; background: #333; color: #fff; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 1.2em; }
        
        .auto-translate-badge { position: absolute; left: 10px; top: 38px; color: var(--success); font-size: 0.8em; display: none; }
    </style>
</head>
<body>

    <div id="loader"><div class="spinner"></div><h3 id="loader-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„...</h3></div>
    <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>
    
    <aside class="sidebar" id="sidebar">
        <div class="logo-area"><h2>Ø³ÙˆÙ‚ Ø¹ÙƒØ§Ø²</h2><span style="color:var(--text-muted); font-size:0.8em;">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°ÙƒÙŠ</span></div>
        <button class="nav-btn active" onclick="switchTab('accounting', this)"><i class="fas fa-chart-pie"></i> Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙˆØ§Ù„Ù…Ø§Ù„ÙŠØ§Øª</button>
        <button class="nav-btn" onclick="switchTab('orders', this)"><i class="fas fa-box-open"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
        <button class="nav-btn" onclick="switchTab('inventory', this)"><i class="fas fa-plus-square"></i> Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø®Ø²Ù†</button>
        <button class="nav-btn" onclick="switchTab('edit-inventory', this)"><i class="fas fa-edit"></i> ÙƒØ±ÙˆØª Ø§Ù„ØµÙ†Ù (ØªØ¹Ø¯ÙŠÙ„)</button>
        <button class="nav-btn" onclick="switchTab('banners', this)"><i class="fas fa-images"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ù†Ø±Ø§Øª (Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)</button>
        <button class="nav-btn" id="nav-templates" onclick="switchTab('templates', this)"><i class="fas fa-ruler-combined"></i> Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª</button>
        <button class="nav-btn" onclick="switchTab('settings', this)"><i class="fas fa-cogs"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± ÙˆØ§Ù„Ù„ÙˆØ¬Ùˆ</button>
        <button class="nav-btn" onclick="switchTab('shipping', this)"><i class="fas fa-truck"></i> ØªØ³Ø¹ÙŠØ± Ø§Ù„Ø´Ø­Ù†</button>
    </aside>

    <main class="main-content">
        <div class="mobile-header"><h2 style="color:var(--primary); margin:0; font-family:'Reem Kufi';">Ø³ÙˆÙ‚ Ø¹ÙƒØ§Ø² ERP</h2><button class="mobile-menu-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button></div>

        <section id="accounting" class="section active">
            <div class="panel">
                <h2 class="panel-title"><i class="fas fa-wallet"></i> Ø§Ù„Ø®Ø²ÙŠÙ†Ø© ÙˆØ­Ø±ÙƒØ© Ø§Ù„Ø£Ù…ÙˆØ§Ù„</h2>
                <div class="stats-grid">
                    <div class="stat-card success" onclick="openReportModal('delivered')"><div class="stat-info"><h3>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…)</h3><p id="acc-safe">0 Ø¬.Ù…</p></div><i class="fas fa-sack-dollar stat-icon"></i></div>
                    <div class="stat-card info" onclick="openReportModal('courier')"><div class="stat-info"><h3>Ù…Ø¹ Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ (Ø¬Ø§Ø±ÙŠ)</h3><p id="acc-courier">0 Ø¬.Ù…</p></div><i class="fas fa-motorcycle stat-icon"></i></div>
                    <div class="stat-card danger" onclick="openReportModal('returns')"><div class="stat-info"><h3>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª</h3><p id="acc-returns">0 Ø¬.Ù…</p></div><i class="fas fa-undo stat-icon"></i></div>
                </div>
            </div>
        </section>

        <section id="orders" class="section">
            <div class="panel">
                <h2 class="panel-title"><i class="fas fa-list"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
                <div style="overflow-x:auto;">
                    <table><thead><tr><th>Ø§Ù„Ø·Ù„Ø¨</th><th>Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ù…ÙƒØ§Ù†</th><th>Ø§Ù„ØªÙˆØ§ØµÙ„</th><th>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead><tbody id="orders-table"></tbody></table>
                </div>
            </div>
        </section>

        <section id="banners" class="section">
            <div class="panel" style="max-width: 800px; margin: auto;">
                <h2 class="panel-title"><i class="fas fa-images"></i> Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø§Ù†Ø±Ø§Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
                <p style="color:#aaa; font-size:0.9em; margin-bottom:20px;">Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ù„ÙŠÙƒÙˆÙ† Ø¨Ø§Ù†Ø± Ø«Ø§Ø¨ØªØŒ Ø£Ùˆ Ø£ÙƒØ«Ø± Ù…Ù† ØµÙˆØ±Ø© Ù„ÙŠØªØ­ÙˆÙ„ Ø¥Ù„Ù‰ Ø³Ù„Ø§ÙŠØ¯Ø± Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒÙŠØ§Ù‹.</p>

                <div style="background:#222; padding:20px; border-radius:10px; margin-bottom:20px; border:1px solid #444;">
                    <div class="switch-container" style="background:none; border:none; padding:0; margin-bottom:15px;"><h3 style="color:var(--primary); margin:0;">1. Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠ</h3><label class="switch"><input type="checkbox" id="banner-top-active"><span class="slider"></span></label></div>
                    <div class="input-group"><input type="file" id="banner-top-files" multiple accept="image/*"></div>
                    <button class="btn-main" onclick="saveBanners('top')" style="background:var(--info); color:#fff;">Ø­ÙØ¸ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠ</button>
                </div>

                <div style="background:#222; padding:20px; border-radius:10px; margin-bottom:20px; border:1px solid #444;">
                    <div class="switch-container" style="background:none; border:none; padding:0; margin-bottom:15px;"><h3 style="color:var(--primary); margin:0;">2. Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„Ø£ÙˆØ³Ø·</h3><label class="switch"><input type="checkbox" id="banner-middle-active"><span class="slider"></span></label></div>
                    <div class="input-group"><input type="file" id="banner-middle-files" multiple accept="image/*"></div>
                    <button class="btn-main" onclick="saveBanners('middle')" style="background:var(--info); color:#fff;">Ø­ÙØ¸ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„Ø£ÙˆØ³Ø·</button>
                </div>

                <div style="background:#222; padding:20px; border-radius:10px; border:1px solid #444;">
                    <div class="switch-container" style="background:none; border:none; padding:0; margin-bottom:15px;"><h3 style="color:var(--primary); margin:0;">3. Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„Ø³ÙÙ„ÙŠ</h3><label class="switch"><input type="checkbox" id="banner-bottom-active"><span class="slider"></span></label></div>
                    <div class="input-group"><input type="file" id="banner-bottom-files" multiple accept="image/*"></div>
                    <button class="btn-main" onclick="saveBanners('bottom')" style="background:var(--info); color:#fff;">Ø­ÙØ¸ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„Ø³ÙÙ„ÙŠ</button>
                </div>
            </div>
        </section>

        <section id="settings" class="section">
            <div class="panel" style="max-width: 600px; margin: auto;">
                <h2 class="panel-title"><i class="fas fa-cogs"></i> ØªØ®ØµÙŠØµ Ù†Ø´Ø§Ø· Ø§Ù„Ù…ØªØ¬Ø± ÙˆØ§Ù„Ù„ÙˆØ¬Ùˆ</h2>
                
                <div class="switch-container"><span>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„ØµÙ„Ø¨Ø© (Ø·ÙˆÙ„ØŒ Ø¹Ø±Ø¶ØŒ ØªØ®Ø§Ù†Ø©)</span><label class="switch"><input type="checkbox" id="set-hard-dim"><span class="slider"></span></label></div>
                <div class="switch-container"><span>ØªÙØ¹ÙŠÙ„ Ø¯Ù„ÙŠÙ„ Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„Ù…Ù„Ø§Ø¨Ø³ (ØµØ¯Ø±ØŒ ÙƒØªÙØŒ ÙƒÙ…)</span><label class="switch"><input type="checkbox" id="set-cloth-guide"><span class="slider"></span></label></div>
                <div class="switch-container"><span>ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª</span><label class="switch"><input type="checkbox" id="set-colors"><span class="slider"></span></label></div>
                <div class="switch-container"><span>ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª ÙˆÙ‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø®Ø²Ù†</span><label class="switch"><input type="checkbox" id="set-sizes"><span class="slider"></span></label></div>
                
                <h3 style="color:var(--primary); margin-top:30px; border-top:1px solid #333; padding-top:20px;">Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø§Ù„Ù„ÙˆØ¬Ùˆ)</h3>
                <p style="color:#aaa; font-size:0.85em; margin-top:-10px; margin-bottom:15px;">ÙŠÙØ¶Ù„ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„ØµÙˆØ± Ø¨ØµÙŠØºØ© PNG ÙˆØ¨Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ© Ù„ØªØ¨Ø¯Ùˆ Ø§Ø­ØªØ±Ø§ÙÙŠØ©.</p>
                
                <div class="flex-row">
                    <div class="input-group" style="background:#222; padding:15px; border-radius:8px; border:1px dashed #555;">
                        <label>Ù„ÙˆØ¬Ùˆ Ø§Ù„Ù‡ÙŠØ¯Ø± (ÙŠØ¸Ù‡Ø± Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹)</label>
                        <input type="file" id="logo-header-file" accept="image/*">
                        <img id="preview-logo-header" style="max-height:50px; margin-top:10px; display:none; border-radius:5px;">
                    </div>
                    <div class="input-group" style="background:#222; padding:15px; border-radius:8px; border:1px dashed #555;">
                        <label>Ù„ÙˆØ¬Ùˆ Ø§Ù„ÙÙˆØªØ± (ÙŠØ¸Ù‡Ø± Ø£Ø³ÙÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹)</label>
                        <input type="file" id="logo-footer-file" accept="image/*">
                        <img id="preview-logo-footer" style="max-height:50px; margin-top:10px; display:none; border-radius:5px;">
                    </div>
                </div>

                <button class="btn-main" onclick="saveStoreSettings()" style="margin-top:15px; padding:15px; font-size:1.1em;">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ÙˆØ¬Ùˆ</button>
            </div>
        </section>

        <section id="inventory" class="section">
            <div class="flex-row">
                <div class="panel">
                    <h3 class="panel-title"><i class="fas fa-folder-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù…</h3>
                    <div class="flex-row">
                        <div class="input-group" style="position:relative;">
                            <label>Ø§Ù„Ø§Ø³Ù… (Ø¹Ø±Ø¨ÙŠ)</label>
                            <input type="text" id="cat-title-ar" onkeyup="smartTranslate(this.value, 'cat-title-en', 'cat-magic')">
                            <i class="fas fa-magic auto-translate-badge" id="cat-magic"></i>
                        </div>
                        <div class="input-group"><label>Ø§Ù„Ø§Ø³Ù… (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ - ØªÙ„Ù‚Ø§Ø¦ÙŠ)</label><input type="text" id="cat-title-en"></div>
                    </div>
                    <div class="input-group"><label>ÙŠØªØ¨Ø¹ Ù‚Ø³Ù… Ø±Ø¦ÙŠØ³ÙŠØŸ</label><select id="cat-parent-id"></select></div>
                    <div style="background:#222; padding:15px; border-radius:8px; margin-bottom:15px;"><label class="checkbox-label"><input type="checkbox" id="cat-show-home" checked> Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŸ</label></div>
                    <button class="btn-main" onclick="addCategory()">Ø­ÙØ¸ Ø§Ù„Ù‚Ø³Ù…</button>
                </div>

                <div class="panel">
                    <h3 class="panel-title"><i class="fas fa-box-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>
                    <div class="input-group"><label>Ø§Ù„Ù‚Ø³Ù…</label><select id="prod-cat"></select></div>
                    <div class="input-group"><label style="color:var(--info);">ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬ (SKU)</label><input type="text" id="prod-code" placeholder="Ù…Ø«Ø§Ù„: P-001"></div>
                    <div class="flex-row">
                        <div class="input-group" style="position:relative;">
                            <label>Ø§Ù„Ø§Ø³Ù… (Ø¹Ø±Ø¨ÙŠ) *</label>
                            <input type="text" id="prod-title-ar" onblur="smartTranslate(this.value, 'prod-title-en', 'prod-magic')">
                            <i class="fas fa-magic auto-translate-badge" id="prod-magic"></i>
                        </div>
                        <div class="input-group"><label>Ø§Ù„Ø§Ø³Ù… (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ - ØªÙ„Ù‚Ø§Ø¦ÙŠ)</label><input type="text" id="prod-title-en"></div>
                    </div>
                    <div class="flex-row"><div class="input-group"><label>Ø§Ù„Ø¨ÙŠØ¹ (Ù‚Ø·Ø§Ø¹ÙŠ)</label><input type="number" id="prod-price"></div><div class="input-group"><label>Ø³Ø¹Ø± Ù‚Ø¯ÙŠÙ… Ù…Ø´Ø·ÙˆØ¨</label><input type="number" id="prod-old-price" placeholder="Ù…Ø«Ø§Ù„: 800"></div></div>
                    <div class="input-group"><label style="color:var(--warning);">Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø£Ø²Ø±Ù‚</label><input type="text" id="prod-promo-msg" placeholder="Ù…Ø«Ø§Ù„: Ø·Ù‚Ù… Ø´ØªÙˆÙŠ Ø£ÙŠ Ø¨Ù†Ø·Ù„ÙˆÙ† + Ø³ÙˆÙŠØª Ø´ÙŠØ±Øª = 1099"></div>
                    <div class="input-group"><label>Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</label><input type="file" id="prod-image" accept="image/*"></div>
                    
                    <div id="div-clothing-guide" class="flex-row" style="background:#1a1a1a; padding:10px; border:1px dashed var(--primary); border-radius:8px; margin-top:10px;">
                        <div class="input-group"><label>Ø§Ù„ØµØ¯Ø±</label><input type="text" id="prod-chest"></div><div class="input-group"><label>Ø§Ù„ÙƒØªÙ</label><input type="text" id="prod-shoulder"></div><div class="input-group"><label>Ø§Ù„Ø·ÙˆÙ„</label><input type="text" id="prod-body"></div>
                    </div>
                    <button class="btn-main" onclick="addProduct()" style="margin-top:15px;">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
                </div>
            </div>
            <div class="flex-row" style="margin-top:20px;">
                <div class="panel" id="panel-sizes">
                    <h3 class="panel-title"><i class="fas fa-ruler"></i> ØªØ­Ø¯ÙŠØ¯ Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬</h3>
                    <div class="input-group"><label>Ø§Ù„Ù…Ù†ØªØ¬</label><select id="size-prod-id"></select></div>
                    <div class="input-group"><label>Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª</label><select id="size-template-select" onchange="loadTemplateOptionsForCheckboxes()"></select></div>
                    <div id="size-checkboxes-container" class="size-checkbox-grid"></div>
                    <button class="btn-main" onclick="saveCheckedSizes()" style="background:var(--success); color:#000; margin-top:15px;">Ø­ÙØ¸ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª</button>
                </div>
            </div>
        </section>

        <section id="edit-inventory" class="section"><div class="panel"><h2 class="panel-title">ÙƒØ±ÙˆØª Ø§Ù„ØµÙ†Ù</h2><table id="edit-products-table"></table></div></section>
        <section id="templates" class="section"><div class="panel"><h2 class="panel-title">Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨</h2></div></section>
        <section id="shipping" class="section"><div class="panel"><h2 class="panel-title">Ø§Ù„Ø´Ø­Ù†</h2></div></section>
    </main>

    <script>
        const SUPABASE_URL = 'https://wkfiocqhkspsvqgyjpea.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_l2vgR8Xbt0Csw8W_Slo_1Q_9glKlIoN';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let systemSettings = {};

        function showLoader(t) { document.getElementById('loader-text').innerText=t; document.getElementById('loader').style.display='flex'; }
        function hideLoader() { document.getElementById('loader').style.display='none'; }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); document.getElementById('sidebar-overlay').classList.toggle('active'); }

        async function initAdmin() { showLoader("ØªØ­Ù…ÙŠÙ„..."); await loadStoreSettingsFromDB(); await loadBannersStatus(); hideLoader(); switchTab('settings', document.querySelector('.nav-btn[onclick*="settings"]')); }
        function switchTab(t, b) { document.querySelectorAll('.section').forEach(s=>s.classList.remove('active')); document.querySelectorAll('.nav-btn').forEach(x=>x.classList.remove('active')); document.getElementById(t).classList.add('active'); if(b) b.classList.add('active'); document.getElementById('sidebar').classList.remove('active'); document.getElementById('sidebar-overlay').classList.remove('active'); if(t==='inventory') { loadCategoriesForSelects(); loadProductsList(); loadSizeTemplatesDropdown(); } }

        async function uploadImage(file) { const fName=`${Date.now()}_${file.name}`; await supabaseClient.storage.from('okaz_images').upload(fName, file); return supabaseClient.storage.from('okaz_images').getPublicUrl(fName).data.publicUrl; }

        // ================= Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù„ÙˆØ¬Ùˆ (Ø§Ù„Ø¬Ø¯ÙŠØ¯) âš™ï¸ =================
        async function loadStoreSettingsFromDB() {
            const { data } = await supabaseClient.from('store_settings').select('*');
            if(data) data.forEach(x => systemSettings[x.setting_key] = x.setting_value);
            
            document.getElementById('set-hard-dim').checked = (systemSettings.enable_hard_dimensions === 'true');
            document.getElementById('set-cloth-guide').checked = (systemSettings.enable_clothing_guide === 'true');
            document.getElementById('set-colors').checked = (systemSettings.enable_colors === 'true');
            document.getElementById('set-sizes').checked = (systemSettings.enable_size_templates === 'true');

            document.getElementById('div-hard-dimensions').style.display = (systemSettings.enable_hard_dimensions === 'true') ? 'flex' : 'none';
            document.getElementById('div-clothing-guide').style.display = (systemSettings.enable_clothing_guide === 'true') ? 'flex' : 'none';
            // document.getElementById('panel-colors').style.display = (systemSettings.enable_colors === 'true') ? 'block' : 'none';
            document.getElementById('panel-sizes').style.display = (systemSettings.enable_size_templates === 'true') ? 'block' : 'none';
            
            // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù„ÙˆØ¬ÙˆÙ‡Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            if(systemSettings.site_logo_header) { document.getElementById('preview-logo-header').src = systemSettings.site_logo_header; document.getElementById('preview-logo-header').style.display = 'block'; }
            if(systemSettings.site_logo_footer) { document.getElementById('preview-logo-footer').src = systemSettings.site_logo_footer; document.getElementById('preview-logo-footer').style.display = 'block'; }
        }

        async function saveStoreSettings() {
            showLoader("Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ±ÙØ¹ Ø§Ù„Ù„ÙˆØ¬Ùˆ...");
            let updates = [
                { setting_key: 'enable_hard_dimensions', setting_value: document.getElementById('set-hard-dim').checked ? 'true' : 'false' },
                { setting_key: 'enable_clothing_guide', setting_value: document.getElementById('set-cloth-guide').checked ? 'true' : 'false' },
                { setting_key: 'enable_colors', setting_value: document.getElementById('set-colors').checked ? 'true' : 'false' },
                { setting_key: 'enable_size_templates', setting_value: document.getElementById('set-sizes').checked ? 'true' : 'false' }
            ];

            const headerFile = document.getElementById('logo-header-file').files[0];
            if(headerFile) { const url = await uploadImage(headerFile); updates.push({ setting_key: 'site_logo_header', setting_value: url }); }

            const footerFile = document.getElementById('logo-footer-file').files[0];
            if(footerFile) { const url = await uploadImage(footerFile); updates.push({ setting_key: 'site_logo_footer', setting_value: url }); }

            for(let u of updates) { await supabaseClient.from('store_settings').upsert({ setting_key: u.setting_key, setting_value: u.setting_value }); }
            
            alert("ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± ÙˆØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ÙˆØ¬Ùˆ Ø¨Ù†Ø¬Ø§Ø­! âœ…");
            document.getElementById('logo-header-file').value = ''; document.getElementById('logo-footer-file').value = '';
            await loadStoreSettingsFromDB();
            hideLoader();
        }

        // ================= Ø§Ù„Ù…ØªØ±Ø¬Ù… Ø§Ù„Ø°ÙƒÙŠ ğŸŒ =================
        async function smartTranslate(text, targetId, badgeId) {
            if(!text || text.length < 2) return;
            const badge = document.getElementById(badgeId); if(badge) { badge.style.display = 'inline-block'; badge.innerText = ' Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ±Ø¬Ù…Ø©...'; }
            let dict = { "Ø¨Ù†Ø·Ù„ÙˆÙ†":"Pants", "Ø¬ÙŠÙ†Ø²":"Jeans", "ØªÙŠØ´ÙŠØ±Øª":"T-Shirt", "Ù‚Ù…ÙŠØµ":"Shirt", "Ø´ÙˆØ²":"Shoes", "Ø­Ø°Ø§Ø¡":"Shoes", "Ø³ÙˆÙŠØª Ø´ÙŠØ±Øª":"Sweatshirt", "Ù‡ÙˆØ¯ÙŠ":"Hoodie", "Ø´Ø±ÙˆØ§Ù„":"Joggers", "ÙˆØ§ÙŠØ¯ Ù„ÙŠØ¬":"Wide Leg", "Ø§ÙˆÙØ± Ø³Ø§ÙŠØ²":"Oversize", "ÙƒØ§Ø±Ø¬Ùˆ":"Cargo" };
            let translated = text; for (const [ar, en] of Object.entries(dict)) { translated = translated.replace(new RegExp(ar, 'g'), en); }
            if (/[\u0600-\u06FF]/.test(translated)) { try { const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=ar|en`); const data = await res.json(); translated = data.responseData.translatedText; } catch(e) {} }
            document.getElementById(targetId).value = translated;
            if(badge) { badge.innerText = ' ØªÙ… Ø§Ù„ØªØ±Ø¬Ù…Ø© âœ“'; setTimeout(()=>badge.style.display='none', 2000); }
        }

        // ================= Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ù†Ø±Ø§Øª ğŸ–¼ï¸ =================
        async function loadBannersStatus() {
            const {data} = await supabaseClient.from('store_banners').select('*');
            if(data) { data.forEach(b => { const chk = document.getElementById(`banner-${b.position_name}-active`); if(chk) chk.checked = b.is_active; }); }
        }

        async function saveBanners(position) {
            const isActive = document.getElementById(`banner-${position}-active`).checked;
            const files = document.getElementById(`banner-${position}-files`).files;
            showLoader(`Ø­ÙØ¸ Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„Ù€ ${position}...`);
            let updates = { is_active: isActive };
            if(files.length > 0) { let urls = []; for(let i=0; i<files.length; i++) urls.push(await uploadImage(files[i])); updates.images = urls; }
            await supabaseClient.from('store_banners').update(updates).eq('position_name', position);
            alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«! âœ…"); hideLoader();
        }

        // ================= Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ =================
        async function addProduct() {
            const c_id = document.getElementById('prod-cat').value, t_ar = document.getElementById('prod-title-ar').value, prc = document.getElementById('prod-price').value, file = document.getElementById('prod-image');
            if(!c_id || !t_ar || !prc || file.files.length===0) return alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù…Ø·Ù„ÙˆØ¨Ø©!"); showLoader("Ø±ÙØ¹ Ø§Ù„Ù…Ù†ØªØ¬...");
            try { 
                const img = await uploadImage(file.files[0]);
                await supabaseClient.from('products').insert([{ category_id: c_id, product_code: document.getElementById('prod-code').value, title_ar: t_ar, title_en: document.getElementById('prod-title-en').value, price: prc, old_price: document.getElementById('prod-old-price').value || 0, promo_message: document.getElementById('prod-promo-msg').value || '', cost_price: document.getElementById('prod-cost-price').value||0, stock_quantity: document.getElementById('prod-stock').value||100, image: img, chest_cm: document.getElementById('prod-chest')?.value||'', shoulder_cm: document.getElementById('prod-shoulder')?.value||'', body_length_cm: document.getElementById('prod-body')?.value||'' }]);
                alert("ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©! ğŸ“¦"); document.getElementById('prod-title-ar').value=''; loadProductsList(); } catch(e){alert("Ø®Ø·Ø£");} hideLoader();
        }

        async function loadCategoriesForSelects() { const {data} = await supabaseClient.from('categories').select('*'); document.getElementById('prod-cat').innerHTML = '<option value="">-- Ø§Ø®ØªØ± --</option>' + data.map(x=>`<option value="${x.id}">${x.title_ar}</option>`).join(''); }
        async function loadProductsList() { const {data} = await supabaseClient.from('products').select('id, title_ar'); document.getElementById('size-prod-id').innerHTML = '<option value="">-- Ø§Ø®ØªØ± --</option>' + data.map(x=>`<option value="${x.id}">${x.title_ar}</option>`).join(''); }
        async function loadSizeTemplatesDropdown() { const {data} = await supabaseClient.from('size_templates').select('*'); document.getElementById('size-template-select').innerHTML = '<option value="">-- Ø§Ù„Ù‚Ø§Ù„Ø¨ --</option>' + data.map(x=>`<option value="${x.id}">${x.template_name}</option>`).join(''); }
        async function loadTemplateOptionsForCheckboxes() { const id=document.getElementById('size-template-select').value, cont=document.getElementById('size-checkboxes-container'); cont.innerHTML=''; if(!id)return; const {data} = await supabaseClient.from('size_template_options').select('*').eq('template_id',id); if(data) data.forEach(o=>cont.innerHTML+=`<label class="size-box" onclick="this.classList.toggle('selected')">${o.size_value}<input type="checkbox" value="${o.size_value}"></label>`); }
        async function saveCheckedSizes() { const pId=document.getElementById('size-prod-id').value, chks=document.querySelectorAll('.size-box.selected input'); if(!pId||chks.length===0)return alert("Ø§Ø®ØªØ±!"); const d=Array.from(chks).map(c=>({product_id:pId, size_name:c.value})); await supabaseClient.from('product_sizes').insert(d); alert("ØªÙ…!"); }

        initAdmin();
    </script>
</body>
</html>
